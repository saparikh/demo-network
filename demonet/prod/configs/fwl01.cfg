version 12.1X46-D35.1;
groups {
    node0 {
        system {
            host-name fwl01;
            syslog {
                source-address 10.254.4.1/16;
            }
            ntp {
                source-address 10.254.4.1/16;
            }
        }
        interfaces {
            fxp0 {
                unit 0 {
                    family inet {
                        address 10.254.4.1/16;
                    }
                }
            }
        }
    }
}
apply-groups node0;
system {
    time-zone UTC;
    services {
        ssh {
            root-login deny;
        }
        netconf {
            ssh;
        }
        web-management {
            http {
                interface fxp0.0;
            }
        }
    }
    syslog {
        user * {
            any emergency;
        }
        file messages {
            any any;
            authorization info;
        }
        file interactive-commands {
            interactive-commands any;
        }
    }
}
chassis {
    cluster {
        reth-count 4;
        redundancy-group 0 {
            node 0 priority 150;
            node 1 priority 100;
        }
        redundancy-group 1 {
            node 0 priority 150;
            node 1 priority 100;
            hold-down-interval 300;
        }
        redundancy-group 2 {
            node 0 priority 150;
            node 1 priority 100;
            hold-down-interval 10;
        }
        redundancy-group 3 {
            node 0 priority 150;
            node 1 priority 100;
            hold-down-interval 300;
        }
        redundancy-group 4 {
            node 0 priority 150;
            node 1 priority 100;
            hold-down-interval 10;
        }
    }
}
security {
    address-book {
        global {
            address GBL_RFC1918-10 10.0.0.0/8;
        }
    }
    screen {
        ids-option ATTACK-SCREEN {
            alarm-without-drop;
            icmp {
                ip-sweep threshold 4000;
                large;
                flood threshold 1000;
                ping-death;
            }
            ip {
                bad-option;
                record-route-option;
                timestamp-option;
                spoofing;
                source-route-option;
                loose-source-route-option;
                strict-source-route-option;
                unknown-protocol;
                tear-drop;
            }
            tcp {
                syn-fin;
                tcp-no-flag;
                port-scan threshold 3000;
                syn-flood {
                    alarm-threshold 2000;
                    attack-threshold 5000;
                    source-threshold 2000;
                    destination-threshold 5000;
                    timeout 5;
                }
                land;
                winnuke;
                tcp-sweep threshold 3000;
            }
            udp {
                flood threshold 2000;
                udp-sweep threshold 1000;
            }
            limit-session {
                source-ip-based 20000;
            }
        }
    }
    policies {
        from-zone INSIDE to-zone SELF {
            policy PERMIT-SSH {
                match {
                    source-address GBL_RFC1918-10;
                    destination-address any;
                    application junos-ssh;
                }
                then {
                    permit;
                }
            }
            policy PERMIT-ICMP {
                match {
                    source-address GBL_RFC1918-10;
                    destination-address any;
                    application junos-icmp-all;
                }
                then {
                    permit;
                }
            }
            policy DENY-INSIDE-SELF {
                match {
                    source-address any;
                    destination-address any;
                    application any;
                }
                then {
                    deny;
                    log {
                        session-init;
                        session-close;
                    }
                }
            }
        }
        global {
            policy DENY-ALL {
                match {
                    source-address any;
                    destination-address any;
                    application any;
                }
                then {
                    deny;
                    log {
                        session-init;
                        session-close;
                    }
                }
            }
        }
    }
    zones {
        security-zone SELF {
            host-inbound-traffic {
                system-services {
                    ping;
                    ssh;
                    snmp;
                }
            }
            interfaces {
                lo0.0;
            }
        }
        security-zone OUTSIDE {
            tcp-rst;
            screen ATTACK-SCREEN;
            host-inbound-traffic {
                system-services {
                    ping;
                }
                protocols {
                    bgp;
                }
            }
            interfaces {
                reth2.0;
                reth3.0;
            }
        }
        security-zone INSIDE {
            tcp-rst;
            host-inbound-traffic {
                system-services {
                    ping;
                }
                protocols {
                    ospf;
                }
            }
            interfaces {
                reth0.0;
                reth1.0;
            }
        }
    }
}
interfaces {
    xe-1/0/0 {
        description "[type=UL, nbr=BL01:??]";
        gigether-options {
            redundant-parent reth0;
        }
    }
    xe-1/0/1 {
        description "[type=UL, nbr=BL02:??]";
        gigether-options {
            redundant-parent reth1;
        }
    }
    xe-2/0/0 {
        description "[type=UL, nbr=BOR01:??]";
        gigether-options {
            redundant-parent reth2;
        }
    }
    xe-2/0/1 {
        description "[type=UL, nbr=B0R02:??]";
        gigether-options {
            redundant-parent reth3;
        }
    }
    xe-9/0/0 {
        description "[type=UL, nbr=BL01:??]";
        gigether-options {
            redundant-parent reth0;
        }
    }
    xe-9/0/1 {
        description "[type=UL, nbr=BL02:??]";
        gigether-options {
            redundant-parent reth1;
        }
    }
    xe-10/0/0 {
        description "[type=UL, nbr=BOR01:??]";
        gigether-options {
            redundant-parent reth2;
        }
    }
    xe-10/0/1 {
        description "[type=UL, nbr=B0R02:??]";
        gigether-options {
            redundant-parent reth3;
        }
    }
    fxp0 {
        enable;
        speed 100m;
        unit 0;
    }
    lo0 {
        description "[type=LO]";
        unit 0 {
            description "[type=LO";
            family inet {
                address 10.1.4.1/32;
            }
        }
    }
    reth0 {
        description "[nbr=BL01:??]";
        redundant-ether-options {
            redundancy-group 1;
            lacp {
                active;
            }
        }
        unit 0 {
            description "[nbr=BL01:??] FWL-INSIDE";
            family inet {
                address 10.2.1.0/31;
            }
        }
    }
    reth1 {
        description "[nbr=BL02:??]";
        redundant-ether-options {
            redundancy-group 2;
            lacp {
                active;
            }
        }
        unit 0 {
            description "[nbr=BL01:??] FWL-INSIDE";
            family inet {
                address 10.2.1.2/31;
            }
        }
    }
    reth2 {
        description "[nbr=BOR01:??]";
        redundant-ether-options {
            redundancy-group 3;
            lacp {
                active;
            }
        }
        unit 0 {
            description "[nbr=BL01:??] FWL-OUTSIDE";
            family inet {
                address 10.2.1.4/31;
            }
        }
    }
    reth3 {
        description "[nbr=BOR02:??]";
        redundant-ether-options {
            redundancy-group 4;
            lacp {
                active;
            }
        }
        unit 0 {
            description "[nbr=BL01:??] FWL-OUTSIDE";
            family inet {
                address 10.2.1.6/31;
            }
        }
    }
}
routing-options {
    router-id 10.1.4.1;
}
policy-options {
    prefix-list DEFAULT-ROUTE {
        0.0.0.0/0;
    }
    prefix-list MARTIANS {
        0.0.0.0/8;
        127.0.0.0/8;
        169.254.0.0/16;
        192.0.2.0/24;
        224.0.0.0/3;
    }
    prefix-list RFC1918 {
        10.0.0.0/8;
        172.16.0.0/12;
        192.168.0.0/16;
        192.168.0.0/32;
    }
    prefix-list LOOPBACKS {
        10.1.0.0/16;
    }
    prefix-list FABRIC_AGG {
        10.100.0.0/16;
        10.200.0.0/16;
    }
    policy-statement EXPORT-BL {
        term DEFAULT-ROUTE {
            from {
                protocol bgp;
                route-filter 0.0.0.0/0 exact;
            }
            then {
                preference 140;
                accept;
            }
        }
        term DENY {
            then reject;
        }
    }
    policy-statement EXPORT-BOR {
        term ADVERTISE_AGG {
            from {
                protocol aggregate;
                prefix-list-filter FABRIC_AGG exact;
            }
            then {
                metric 100;
                accept;
            }
        }
    }
    policy-statement FABRIC_AGG {
        from {
            protocol bgp;
            prefix-list-filter FABRIC_AGG orlonger;
        }
        then accept;
    }
    policy-statement IMPORT-BL {
        term FABRIC_SCOPE {
            from {
                protocol bgp;
                prefix-list-filter FABRIC_AGG orlonger;
            }
            then {
                metric 100;
                accept;
            }
        }
    }
    policy-statement IMPORT-BOR {
        term DEFAULT-ROUTE {
            from {
                protocol bgp;
                prefix-list-filter DEFAULT-ROUTE exact;
            }
            then {
                preference 140;
                accept;
            }
        }
        term DENY {
            then reject;
        }
    }
    policy-statement NEXT-HOP-SELF {
        term NHS {
            then {
                next-hop self;
                next policy;
            }
        }
    }
}
routing-instances {
    DATA {
        instance-type virtual-router;
        interface lo0.0;
        interface reth0.0;
        interface reth1.0;
        interface reth2.0;
        interface reth3.0;
        routing-options {
            graceful-restart;
            aggregate {
                route 10.100.0.0/16;
                route 10.200.0.0/16;
            }
            router-id 10.1.4.1;
        }
        protocols {
            bgp {
                path-selection always-compare-med;
                advertise-inactive;
                log-updown;
                group EBGP-BOR {
                    type external;
                    description "[peer=BORs] EBGP";
                    import IMPORT-BOR;
                    export [ NEXT-HOP-SELF EXPORT-BOR ];
                    local-as 65301;
                    neighbor 10.2.1.5{
                        description "[peer=BOR01] EBGP";
                        peer-as 65401;
                    }
                    neighbor 10.2.1.7 {
                        description "[peer=BOR02] EBGP";
                        peer-as 65402;
                    }
                }
                group EBGP-BL {
                    type external;
                    description "[peer=BLs] EBGP";
                    import IMPORT-BL;
                    export [ NEXT-HOP-SELF EXPORT-BL ];
                    local-as 65301;
                    neighbor 10.2.1.1 {
                        description "[peer=BL01] EBGP";
                        peer-as 65201;
                    }
                    neighbor 10.2.1.3 {
                        description "[peer=BL02] EBGP";
                        peer-as 65202;
                    }
                }
            }
        }
    }
}

security {
    address-book {
        global {
                address CLOUDFLARE_0 1.1.1.1/32;
                address GOOGLE_DNS_0 8.8.4.4/32;
                address GOOGLE_DNS_1 8.8.8.8/32;
                address WEB-SERVERS_0 10.200.1.0/24;
                address WEB-SERVERS_1 10.200.2.0/24;
                address-set CLOUDFLARE {
                    address CLOUDFLARE_0;
                }
                address-set GOOGLE_DNS {
                    address GOOGLE_DNS_0;
                    address GOOGLE_DNS_1;
                }
                address-set WEB-SERVERS {
                    address WEB-SERVERS_0;
                    address WEB-SERVERS_1;
                }
        }
    }
    /*
    $Id:$
    $Date:$
    $Revision:$
    */
    policies {
        /*
        */
        from-zone INSIDE to-zone OUTSIDE {
            policy PERMIT-ICMP {
                match {
                    source-address any;
                    destination-address any;
                    application PERMIT-ICMP-app;
                }
                then {
                    permit;
                    log {
                        session-init;
                    }
                }
            }
            policy PERMIT-WEB {
                match {
                    source-address any;
                    destination-address [ WEB-SERVERS ];
                    application PERMIT-WEB-app;
                }
                then {
                    permit;
                    log {
                        session-init;
                    }
                }
            }
            policy PERMIT-SMTP {
                match {
                    source-address any;
                    destination-address any;
                    application PERMIT-SMTP-app;
                }
                then {
                    permit;
                }
            }
            policy PERMIT-DNS {
                match {
                    source-address any;
                    destination-address [ CLOUDFLARE GOOGLE_DNS ];
                    application PERMIT-DNS-app;
                }
                then {
                    permit;
                }
            }
            policy BLOCK-OTHER-DNS {
                match {
                    source-address any;
                    destination-address any;
                    application PERMIT-DNS-app;
                }
                then {
                    deny;
                    log {
                        session-init;
                    }
                }
            }
            policy PERMIT-NTP {
                match {
                    source-address any;
                    destination-address any;
                    application PERMIT-NTP-app;
                }
                then {
                    permit;
                    log {
                        session-init;
                    }
                }
            }
            policy BLOCK-BAD {
                match {
                    source-address any;
                    destination-address any;
                    application BLOCK-BAD-app;
                }
                then {
                    deny;
                    log {
                        session-init;
                    }
                }
            }
            policy CATCH-ALL {
                match {
                    source-address any;
                    destination-address any;
                    application any;
                }
                then {
                    permit;
                    log {
                        session-init;
                    }
                }
            }
            policy default-deny {
                match {
                    source-address any;
                    destination-address any;
                    application any;
                }
                then {
                    deny;
                }
            }
        }
    }
}
applications {
    application BLOCK-BAD-app1 {
        term t1 protocol tcp destination-port 23;
    }
    application BLOCK-BAD-app2 {
        term t2 protocol tcp destination-port 67-68;
    }
    application BLOCK-BAD-app3 {
        term t3 protocol tcp destination-port 111;
    }
    application BLOCK-BAD-app4 {
        term t4 protocol tcp destination-port 113;
    }
    application BLOCK-BAD-app5 {
        term t5 protocol tcp destination-port 135;
    }
    application BLOCK-BAD-app6 {
        term t6 protocol tcp destination-port 389;
    }
    application BLOCK-BAD-app7 {
        term t7 protocol tcp destination-port 1433-1434;
    }
    application BLOCK-BAD-app8 {
        term t8 protocol tcp destination-port 3389;
    }
    application BLOCK-BAD-app9 {
        term t9 protocol tcp destination-port 5432;
    }
    application BLOCK-BAD-app10 {
        term t10 protocol udp destination-port 23;
    }
    application BLOCK-BAD-app11 {
        term t11 protocol udp destination-port 67-68;
    }
    application BLOCK-BAD-app12 {
        term t12 protocol udp destination-port 111;
    }
    application BLOCK-BAD-app13 {
        term t13 protocol udp destination-port 113;
    }
    application BLOCK-BAD-app14 {
        term t14 protocol udp destination-port 135;
    }
    application BLOCK-BAD-app15 {
        term t15 protocol udp destination-port 389;
    }
    application BLOCK-BAD-app16 {
        term t16 protocol udp destination-port 1433-1434;
    }
    application BLOCK-BAD-app17 {
        term t17 protocol udp destination-port 3389;
    }
    application BLOCK-BAD-app18 {
        term t18 protocol udp destination-port 5432;
    }
    application PERMIT-DNS-app1 {
        term t1 protocol tcp destination-port 53;
    }
    application PERMIT-DNS-app2 {
        term t2 protocol udp destination-port 53;
    }
    application PERMIT-ICMP-app {
        term t1 protocol icmp icmp-type 0 inactivity-timeout 60;
        term t2 protocol icmp icmp-type 8 inactivity-timeout 60;
    }
    application PERMIT-NTP-app1 {
        term t1 protocol udp destination-port 123;
    }
    application PERMIT-SMTP-app1 {
        term t1 protocol tcp destination-port 25;
    }
    application-set BLOCK-BAD-app {
        application BLOCK-BAD-app1;
        application BLOCK-BAD-app2;
        application BLOCK-BAD-app3;
        application BLOCK-BAD-app4;
        application BLOCK-BAD-app5;
        application BLOCK-BAD-app6;
        application BLOCK-BAD-app7;
        application BLOCK-BAD-app8;
        application BLOCK-BAD-app9;
        application BLOCK-BAD-app10;
        application BLOCK-BAD-app11;
        application BLOCK-BAD-app12;
        application BLOCK-BAD-app13;
        application BLOCK-BAD-app14;
        application BLOCK-BAD-app15;
        application BLOCK-BAD-app16;
        application BLOCK-BAD-app17;
        application BLOCK-BAD-app18;
    }
    application-set PERMIT-DNS-app {
        application PERMIT-DNS-app1;
        application PERMIT-DNS-app2;
    }
    application-set PERMIT-NTP-app {
        application PERMIT-NTP-app1;
    }
    application-set PERMIT-SMTP-app {
        application PERMIT-SMTP-app1;
    }
}

security {
    address-book {
        global {
                address HOME_DEBUG 100.1.1.1/32;
                address PERMIT-ICMP_DST_EXCLUDE_0 0.0.0.0/5;
                address PERMIT-ICMP_DST_EXCLUDE_1 8.0.0.0/7;
                address PERMIT-ICMP_DST_EXCLUDE_2 10.0.0.0/10;
                address PERMIT-ICMP_DST_EXCLUDE_3 10.64.0.0/11;
                address PERMIT-ICMP_DST_EXCLUDE_4 10.96.0.0/14;
                address PERMIT-ICMP_DST_EXCLUDE_5 10.101.0.0/16;
                address PERMIT-ICMP_DST_EXCLUDE_6 10.102.0.0/15;
                address PERMIT-ICMP_DST_EXCLUDE_7 10.104.0.0/13;
                address PERMIT-ICMP_DST_EXCLUDE_8 10.112.0.0/12;
                address PERMIT-ICMP_DST_EXCLUDE_9 10.128.0.0/9;
                address PERMIT-ICMP_DST_EXCLUDE_10 11.0.0.0/8;
                address PERMIT-ICMP_DST_EXCLUDE_11 12.0.0.0/6;
                address PERMIT-ICMP_DST_EXCLUDE_12 16.0.0.0/4;
                address PERMIT-ICMP_DST_EXCLUDE_13 32.0.0.0/3;
                address PERMIT-ICMP_DST_EXCLUDE_14 64.0.0.0/2;
                address PERMIT-ICMP_DST_EXCLUDE_15 128.0.0.0/1;
                address WEB-SERVERS_0 10.200.1.0/24;
                address WEB-SERVERS_1 10.200.2.0/24;
                address-set PERMIT-ICMP_DST_EXCLUDE {
                    address PERMIT-ICMP_DST_EXCLUDE_0;
                    address PERMIT-ICMP_DST_EXCLUDE_1;
                    address PERMIT-ICMP_DST_EXCLUDE_2;
                    address PERMIT-ICMP_DST_EXCLUDE_3;
                    address PERMIT-ICMP_DST_EXCLUDE_4;
                    address PERMIT-ICMP_DST_EXCLUDE_5;
                    address PERMIT-ICMP_DST_EXCLUDE_6;
                    address PERMIT-ICMP_DST_EXCLUDE_7;
                    address PERMIT-ICMP_DST_EXCLUDE_8;
                    address PERMIT-ICMP_DST_EXCLUDE_9;
                    address PERMIT-ICMP_DST_EXCLUDE_10;
                    address PERMIT-ICMP_DST_EXCLUDE_11;
                    address PERMIT-ICMP_DST_EXCLUDE_12;
                    address PERMIT-ICMP_DST_EXCLUDE_13;
                    address PERMIT-ICMP_DST_EXCLUDE_14;
                    address PERMIT-ICMP_DST_EXCLUDE_15;
                }
                address-set WEB-SERVERS {
                    address WEB-SERVERS_0;
                    address WEB-SERVERS_1;
                }
        }
    }
    /*
    $Id:$
    $Date:$
    $Revision:$
    */
    policies {
        /*
        */
        from-zone OUTSIDE to-zone INSIDE {
            policy PERMIT-ICMP {
                match {
                    source-address any;
                    destination-address [ PERMIT-ICMP_DST_EXCLUDE ];
                    application PERMIT-ICMP-app;
                }
                then {
                    permit;
                    log {
                        session-init;
                    }
                }
            }
            policy PERMIT-WEB {
                match {
                    source-address any;
                    destination-address [ WEB-SERVERS ];
                    application PERMIT-WEB-app;
                }
                then {
                    permit;
                    log {
                        session-init;
                    }
                }
            }
            policy PERMIT-WEB-DEBUG {
                match {
                    source-address HOME_DEBUG;
                    destination-address [ WEB-SERVERS ];
                    application PERMIT-WEB-debug;
                }
                then {
                    permit;
                    log {
                        session-init;
                    }
                }
            }
            policy default-deny {
                match {
                    source-address any;
                    destination-address any;
                    application any;
                }
                then {
                    deny;
                }
            }
        }
    }
}
applications {
    application PERMIT-ICMP-app {
        term t1 protocol icmp icmp-type 0 inactivity-timeout 60;
        term t2 protocol icmp icmp-type 8 inactivity-timeout 60;
    }
    application PERMIT-WEB-80 {
        term t1 protocol tcp destination-port 80;
    }
    application PERMIT-WEB-443 {
        term t1 protocol tcp destination-port 443;
    }
    application-set PERMIT-WEB-app {
        application PERMIT-WEB-443;
    }
    application-set PERMIT-WEB-debug {
        application PERMIT-WEB-80;
    }
}
policy-options {
    prefix-list SNMP_ACCESS_LIST {
        10.1.4.0/22;
        10.1.255.0/24;
        10.2.234.0/24;
    }
}
snmp {
    community COMM2 {
        authorization {
            read-only;
        }
        client-list-name {
            SNMP_ACCESS_LIST;
        }
    }
    trap-group COMM2 {
        version v2;
        categories link startup;
        targets {
            10.1.4.1;
            10.72.48.141;
        }
    }
}

